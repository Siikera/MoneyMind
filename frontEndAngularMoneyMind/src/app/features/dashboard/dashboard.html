<div class="min-h-screen bg-neutral-light flex flex-col items-center p-4">
  <header class="w-full max-w-4xl mx-auto mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4 ">
    <div>
      <h1 class="text-3xl font-bold text-primary mb-1">Dashboard Financeiro</h1>
      <p class="text-neutral-dark">Bem-vindo! Acompanhe seu saldo, contas, lan√ßamentos e gerencie usu√°rios.</p>
      <div *ngIf="usuarioError" class="text-red-600 text-sm mt-2">{{ usuarioError }}</div>
      <button (click)="onShowUser()" class="bg-primary text-white px-4 py-2 rounded font-bold shadow hover:bg-primary-light transition mt-2">Mostrar Dados do Usu√°rio</button>
      <div *ngIf="showUser && usuario && !editMode" class="bg-white rounded-lg shadow p-3 mt-2 flex flex-col gap-1">
  <span class="font-bold text-primary">Usu√°rio logado:</span>
  <span><b>ID:</b> {{ usuario.idUsuario }}</span>
  <span><b>Nome:</b> {{ usuario.nomeUsuario }}</span>
  <span><b>Email:</b> {{ usuario.emailUsuario }}</span>
  <span><b>Data de Nascimento:</b> {{ usuario.dataNascimento }}</span>
        <div class="flex gap-2 mt-2">
          <button (click)="onEditUser()" >Alterar</button>
          <button (click)="onDeleteUser()" class="bg-red-600 text-white px-4 py-2 rounded font-bold hover:bg-red-700 transition">Excluir</button>
        </div>
      </div>
  <form *ngIf="showUser && editMode && editUsuario" class="bg-white rounded-lg shadow p-3 mt-2 flex flex-col gap-2" (ngSubmit)="onSaveEdit()">
        <span class="font-bold text-primary">Editar Usu√°rio</span>
  <label>Nome:<input class="border rounded p-2 w-full" [(ngModel)]="editUsuario.nomeUsuario" name="nomeUsuario" required></label>
  <label>Email:<input class="border rounded p-2 w-full" [(ngModel)]="editUsuario.emailUsuario" name="emailUsuario" required></label>
  <label>Data de Nascimento:<input class="border rounded p-2 w-full" [(ngModel)]="editUsuario.dataNascimento" name="dataNascimento" required type="date"></label>
  <label>Senha:<input class="border rounded p-2 w-full" [(ngModel)]="editSenha" name="editSenha" required type="password" placeholder="Confirme sua senha"></label>
        <div class="flex gap-2 mt-2">
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded font-bold hover:bg-green-700 transition">Salvar</button>
          <button type="button" (click)="onCancelEdit()" class="bg-gray-400 text-white px-4 py-2 rounded font-bold hover:bg-gray-500 transition">Cancelar</button>
        </div>
  <div *ngIf="editError" class="text-red-600 text-sm mt-2">{{ editError }}</div>
  <div *ngIf="updateSuccess" class="text-green-600 text-sm mt-2">Alterado com sucesso!</div>
      </form>
    </div>
  </header>
  <main class="w-full max-w-4xl mx-auto flex-1 grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Card Saldo -->
    <section class="col-span-1 bg-gradient-to-br from-primary-light to-primary-dark text-white rounded-2xl p-6 flex flex-col items-center shadow-lg">
      <span class="text-lg">Saldo Calculado</span>
      <span class="text-4xl font-bold mt-2 mb-1" [ngClass]="saldoCalculado >= 0 ? 'text-green-300' : 'text-red-300'">
        {{ saldoCalculado | currency:'BRL' }}
      </span>
      <span class="text-sm opacity-80">Baseado nos lan√ßamentos</span>
      
      <!-- Alerta de Limite Excedido -->
      <div *ngIf="limiteExcedido" class="mt-4 bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-lg animate-pulse">
        ‚ö†Ô∏è ATEN√á√ÉO: Limite da conta excedido!
      </div>
    </section>
    <!-- Card Contas -->
    <section class="col-span-1 bg-white rounded-2xl p-6 shadow-lg flex flex-col min-h-[280px]">
      <h2 class="text-xl font-semibold mb-4 text-primary">Conta Ativa</h2>
      <div *ngIf="contaAtiva" class="flex flex-col gap-3">
        <div class="flex justify-between items-center border-b border-neutral-light pb-2">
          <div class="flex items-center gap-2">
            <span class="inline-block w-3 h-3 bg-primary-light rounded-full"></span>
            <span class="font-medium">{{ contaAtiva.descricao }}</span>
          </div>
          <span class="font-bold">{{ contaAtiva.saldo | currency:'BRL' }}</span>
        </div>
        <div class="text-sm text-neutral-dark space-y-1">
          <p><strong>Ag√™ncia:</strong> {{ contaAtiva.agencia }}</p>
          <p><strong>N√∫mero:</strong> {{ contaAtiva.numero }}</p>
          <p><strong>Tipo:</strong> {{ contaAtiva.tipoConta === 1 ? 'Conta Corrente' : contaAtiva.tipoConta === 2 ? 'Conta Poupan√ßa' : contaAtiva.tipoConta === 3 ? 'Conta Sal√°rio' : contaAtiva.tipoConta === 4 ? 'Conta Digital' : 'Conta Investimento' }}</p>
          <p><strong>Limite:</strong> {{ contaAtiva.limite | currency:'BRL' }}</p>
        </div>
      </div>
      <div *ngIf="!contaAtiva" class="text-neutral-dark text-sm">Nenhuma conta selecionada.</div>
    </section>
    <!-- Card Lan√ßamentos -->
    <section class="col-span-1 bg-white rounded-2xl p-6 shadow-lg flex flex-col min-h-[280px]">
      <h2 class="text-xl font-semibold mb-4 text-primary">√öltimos Lan√ßamentos</h2>
      <ul class="flex flex-col gap-3">
        <li *ngFor="let lanc of lancamentos.slice(0, 3)" class="flex justify-between items-center border-b border-neutral-light pb-2">
          <span class="font-medium">{{ lanc.descricaoOperacao }}</span>
          <span [class]="lanc.tipoOperacao === 1 ? 'text-green-600 font-bold' : 'text-red-600 font-bold'">
            {{ lanc.tipoOperacao === 1 ? '+' : '-' }}{{ lanc.valorOperacao | currency:'BRL' }}
          </span>
        </li>
        <li *ngIf="lancamentos.length === 0" class="text-neutral-dark text-sm">Nenhum lan√ßamento encontrado.</li>
      </ul>
    </section>
  </main>

  <!-- Card Relat√≥rio Financeiro -->
  <section class="w-full max-w-4xl mx-auto mt-6 bg-white rounded-2xl p-6 shadow-lg">
    <h2 class="text-2xl font-bold text-primary mb-4">Gerar Relat√≥rio Financeiro</h2>
    <div class="flex flex-col md:flex-row gap-4 items-end">
      <div class="flex-1">
        <label for="mesRelatorio" class="block font-medium mb-1">Selecione o M√™s:</label>
        <input id="mesRelatorio" name="mesRelatorio" type="month" [(ngModel)]="mesRelatorio" required class="border rounded p-2 w-full" />
      </div>
      <button (click)="gerarRelatorio()" [disabled]="!mesRelatorio" class="bg-primary text-white px-6 py-2 rounded font-bold shadow hover:bg-primary-light transition disabled:bg-gray-400 disabled:cursor-not-allowed">
        üìä Gerar Relat√≥rio
      </button>
    </div>
    <div *ngIf="relatorioError" class="text-red-600 text-sm mt-2">{{ relatorioError }}</div>
  </section>

  <!-- Cadastro de Lan√ßamentos -->
  <section class="w-full max-w-4xl mx-auto mt-8 bg-white rounded-2xl p-6 shadow-lg">
    <h2 class="text-2xl font-bold text-primary mb-4">Cadastro de Lan√ßamentos</h2>
    <form (ngSubmit)="onSubmitFluxo()" autocomplete="off" class="flex flex-col gap-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="tipoOperacao" class="block font-medium mb-1">Tipo de Opera√ß√£o:</label>
          <select id="tipoOperacao" name="tipoOperacao" [(ngModel)]="tipoOperacao" required class="border rounded p-2 w-full">
            <option *ngFor="let tipo of tiposOperacao" [ngValue]="tipo.id">{{ tipo.descricao }}</option>
          </select>
        </div>
        <div>
          <label for="descricaoOperacao" class="block font-medium mb-1">Descri√ß√£o:</label>
          <input id="descricaoOperacao" name="descricaoOperacao" [(ngModel)]="descricaoOperacao" required class="border rounded p-2 w-full" />
        </div>
        <div>
          <label for="valorOperacao" class="block font-medium mb-1">Valor:</label>
          <input id="valorOperacao" name="valorOperacao" type="number" step="0.01" [(ngModel)]="valorOperacao" required class="border rounded p-2 w-full" />
        </div>
        <div>
          <label for="dataOperacao" class="block font-medium mb-1">Data da Opera√ß√£o:</label>
          <input id="dataOperacao" name="dataOperacao" type="date" [(ngModel)]="dataOperacao" required class="border rounded p-2 w-full" />
        </div>
        <div>
          <label for="dataVencimento" class="block font-medium mb-1">Data de Vencimento:</label>
          <input id="dataVencimento" name="dataVencimento" type="date" [(ngModel)]="dataVencimento" required class="border rounded p-2 w-full" />
        </div>
        <div>
          <label for="parcela" class="block font-medium mb-1">Parcela:</label>
          <input id="parcela" name="parcela" [(ngModel)]="parcela" required class="border rounded p-2 w-full" placeholder="Ex: 1/12" />
        </div>
        <div>
          <label for="situacao" class="block font-medium mb-1">Situa√ß√£o:</label>
          <select id="situacao" name="situacao" [(ngModel)]="situacao" required class="border rounded p-2 w-full">
            <option *ngFor="let sit of situacoes" [ngValue]="sit.id">{{ sit.descricao }}</option>
          </select>
        </div>
        <div>
          <label for="centroCusto" class="block font-medium mb-1">Centro de Custo:</label>
          <select id="centroCusto" name="centroCusto" [(ngModel)]="centroCustoId" class="border rounded p-2 w-full">
            <option [ngValue]="null">Nenhum</option>
            <option *ngFor="let cc of centrosCusto" [ngValue]="cc.idCentro">{{ cc.descricaoCentro }}</option>
          </select>
        </div>
        <div>
          <label for="pessoa" class="block font-medium mb-1">Pessoa:</label>
          <select id="pessoa" name="pessoa" [(ngModel)]="pessoaId" class="border rounded p-2 w-full">
            <option [ngValue]="null">Nenhuma</option>
            <option *ngFor="let p of pessoas" [ngValue]="p.idPessoa">{{ p.razaoSocial }}</option>
          </select>
        </div>
      </div>
      <button type="submit" [disabled]="fluxoLoading" class="bg-primary text-white px-4 py-2 rounded font-bold shadow hover:bg-primary-light transition">
        Cadastrar Lan√ßamento
      </button>
      <div *ngIf="fluxoError" class="text-red-600 text-sm">{{ fluxoError }}</div>
      <div *ngIf="fluxoSuccess" class="text-green-600 text-sm">Lan√ßamento cadastrado com sucesso!</div>
    </form>

    <!-- Tabela de Lan√ßamentos -->
    <div class="mt-6">
      <h3 class="text-xl font-semibold mb-4 text-primary">Todos os Lan√ßamentos</h3>
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-primary text-white">
            <th class="p-2 text-left">Tipo</th>
            <th class="p-2 text-left">Descri√ß√£o</th>
            <th class="p-2 text-left">Valor</th>
            <th class="p-2 text-left">Data</th>
            <th class="p-2 text-left">Vencimento</th>
            <th class="p-2 text-left">Parcela</th>
            <th class="p-2 text-left">Situa√ß√£o</th>
            <th class="p-2 text-left">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let lanc of lancamentos" class="border-b">
            <td class="p-2">{{ lanc.tipoOperacao === 1 ? 'Entrada' : 'Sa√≠da' }}</td>
            <td class="p-2">{{ lanc.descricaoOperacao }}</td>
            <td class="p-2" [class]="lanc.tipoOperacao === 1 ? 'text-green-600 font-bold' : 'text-red-600 font-bold'">
              {{ lanc.tipoOperacao === 1 ? '+' : '-' }}{{ lanc.valorOperacao | currency:'BRL' }}
            </td>
            <td class="p-2">{{ lanc.dataOperacao | date:'dd/MM/yyyy' }}</td>
            <td class="p-2">{{ lanc.dataVencimento | date:'dd/MM/yyyy' }}</td>
            <td class="p-2">{{ lanc.parcela }}</td>
            <td class="p-2">{{ lanc.situacao === 1 ? 'Pendente' : 'Pago' }}</td>
            <td class="p-2">
              <button type="button" (click)="excluirFluxo(lanc.idOperacao ?? 0)" class="bg-red-600 text-white px-2 py-1 rounded text-sm hover:bg-red-700 transition">
                Excluir
              </button>
            </td>
          </tr>
          <tr *ngIf="lancamentos.length === 0">
            <td colspan="8" class="p-2 text-center text-neutral-dark">Nenhum lan√ßamento cadastrado.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>

